<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç‘œä¼½å‹•ä½œæ‡‰ç”¨ - Assignment 2.2</title>
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"
    ></script>
    <script
      nomodule
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css"
    />
    
    <style>
      /* èˆ‡åŸç‰ˆç›¸åŒçš„æ¨£å¼ */
      .item-image {
        width: 100%;
        max-width: 300px;
        height: auto;
        border-radius: 8px;
        margin-bottom: 10px;
      }
      
      .video-thumbnail {
        position: relative;
        display: inline-block;
        cursor: pointer;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: transform 0.2s ease;
      }
      
      .video-thumbnail:hover {
        transform: scale(1.02);
      }
      
      .poses-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        padding: 16px;
      }
      
      .pose-card {
        flex: 1 1 300px;
        min-width: 280px;
      }
      
      .filter-container {
        padding: 16px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .filter-row {
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
      }
      
      .filter-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .filter-item label {
        font-size: 14px;
        font-weight: 500;
        color: #666;
      }
      
      @media (max-width: 768px) {
        .filter-row {
          flex-direction: column;
          align-items: stretch;
        }
        
        .filter-item {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <ion-app>
      <!-- Header -->
      <ion-header>
        <ion-toolbar>
          <ion-title>ç‘œä¼½å‹•ä½œæ‡‰ç”¨</ion-title>
          <ion-buttons slot="end">
            <ion-button id="auth-btn">ç™»å…¥</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <!-- Content -->
      <ion-content>
        <!-- æœç´¢å’Œç¯©é¸å€åŸŸ -->
        <div class="filter-container">
          <div class="filter-row">
            <div class="filter-item" style="flex: 2;">
              <label>æœç´¢ç‘œä¼½å‹•ä½œ</label>
              <ion-searchbar id="search-bar" placeholder="æœç´¢å‹•ä½œåç¨±ã€æè¿°æˆ–å¥½è™•..."></ion-searchbar>
            </div>
            
            <div class="filter-item">
              <label>åˆ†é¡ç¯©é¸</label>
              <ion-select id="category-select" placeholder="æ‰€æœ‰åˆ†é¡">
                <ion-select-option value="">æ‰€æœ‰åˆ†é¡</ion-select-option>
                <ion-select-option value="ç«™å§¿å¼">ç«™å§¿å¼</ion-select-option>
                <ion-select-option value="åå§¿å¼">åå§¿å¼</ion-select-option>
                <ion-select-option value="å¹³è¡¡å¼">å¹³è¡¡å¼</ion-select-option>
                <ion-select-option value="å¾Œå½å¼">å¾Œå½å¼</ion-select-option>
                <ion-select-option value="å‰å½å¼">å‰å½å¼</ion-select-option>
                <ion-select-option value="æ‰­è½‰å¼">æ‰­è½‰å¼</ion-select-option>
                <ion-select-option value="å€’ç«‹å¼">å€’ç«‹å¼</ion-select-option>
                <ion-select-option value="ä¼‘æ¯å¼">ä¼‘æ¯å¼</ion-select-option>
                <ion-select-option value="é–‹é«–å¼">é–‹é«–å¼</ion-select-option>
              </ion-select>
            </div>
            
            <div class="filter-item">
              <label>æ¯é é¡¯ç¤º</label>
              <ion-select id="limit-select" value="10">
                <ion-select-option value="5">5 é …</ion-select-option>
                <ion-select-option value="10">10 é …</ion-select-option>
                <ion-select-option value="20">20 é …</ion-select-option>
                <ion-select-option value="50">50 é …</ion-select-option>
              </ion-select>
            </div>
          </div>
        </div>

        <!-- è¼‰å…¥ç‹€æ…‹ -->
        <div id="loading-container" style="text-align: center; padding: 40px;">
          <ion-spinner name="crescent"></ion-spinner>
          <p id="loading-message">è¼‰å…¥ç‘œä¼½å‹•ä½œä¸­...</p>
        </div>
        
        <!-- éŒ¯èª¤ç‹€æ…‹ -->
        <div id="error-container" style="display: none; text-align: center; padding: 40px;">
          <p id="error-message">è¼‰å…¥å¤±æ•—</p>
          <ion-button id="retry-btn" onclick="loadData()">é‡è©¦</ion-button>
        </div>
        
        <!-- æ•¸æ“šé¡¯ç¤ºå€åŸŸ -->
        <div id="poses-list" style="display: none;">
          <!-- ç‘œä¼½å‹•ä½œå¡ç‰‡å°‡åœ¨é€™è£¡é¡¯ç¤º -->
        </div>
        
        <!-- åˆ†é ä¿¡æ¯å’Œè¼‰å…¥æ›´å¤š -->
        <div id="pagination-container" style="display: none; text-align: center; padding: 20px;">
          <p id="pagination-info">é¡¯ç¤ºç¬¬ 1-10 é …ï¼Œå…± 50 é …</p>
          <ion-button id="load-more-btn" fill="outline" onclick="loadMoreData()">è¼‰å…¥æ›´å¤š</ion-button>
          <div id="load-more-error" style="display: none; color: red; margin-top: 10px;">è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡è©¦</div>
          <div id="no-more-data" style="display: none; color: #666; margin-top: 10px;">æ²’æœ‰æ›´å¤šæ•¸æ“šäº†</div>
        </div>
      </ion-content>

      <!-- ç™»å…¥/è¨»å†Šæ¨¡æ…‹æ¡† -->
      <ion-modal id="auth-modal">
        <ion-header>
          <ion-toolbar>
            <ion-title id="auth-title">ç™»å…¥</ion-title>
            <ion-buttons slot="end">
              <ion-button onclick="closeAuthModal()">
                <ion-icon name="close"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        
        <ion-content>
          <ion-list>
            <ion-item>
              <ion-label position="stacked">é›»å­éƒµä»¶</ion-label>
              <ion-input id="email-input" type="email" placeholder="è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶"></ion-input>
            </ion-item>
            
            <ion-item>
              <ion-label position="stacked">å¯†ç¢¼</ion-label>
              <ion-input id="password-input" type="password" placeholder="è¼¸å…¥æ‚¨çš„å¯†ç¢¼"></ion-input>
            </ion-item>
            
            <ion-item id="confirm-password-item" style="display: none;">
              <ion-label position="stacked">ç¢ºèªå¯†ç¢¼</ion-label>
              <ion-input id="confirm-password-input" type="password" placeholder="å†æ¬¡è¼¸å…¥å¯†ç¢¼"></ion-input>
            </ion-item>
          </ion-list>
          
          <div style="padding: 20px;">
            <ion-button expand="block" id="auth-submit-btn" onclick="handleAuth()">ç™»å…¥</ion-button>
            <ion-button expand="block" fill="clear" id="auth-toggle-btn" onclick="toggleAuthMode()">
              é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿè¨»å†Š
            </ion-button>
          </div>
        </ion-content>
      </ion-modal>

      <!-- ç™»å‡ºç¢ºèªæ¨¡æ…‹æ¡† -->
      <ion-modal id="logout-confirm-modal">
        <ion-header>
          <ion-toolbar>
            <ion-title>ç¢ºèªç™»å‡º</ion-title>
          </ion-toolbar>
        </ion-header>
        
        <ion-content>
          <div style="padding: 20px; text-align: center;">
            <p>æ‚¨ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
              <ion-button fill="outline" onclick="closeLogoutModal()">å–æ¶ˆ</ion-button>
              <ion-button onclick="confirmLogout()">ç¢ºèªç™»å‡º</ion-button>
            </div>
          </div>
        </ion-content>
      </ion-modal>
    </ion-app>

    <script>
      // å…¨å±€è®Šé‡
      let allItems = [];
      let filteredItems = [];
      let currentUser = null;
      let currentPage = 1;
      let itemsPerPage = 10;
      let isLoginMode = true;
      let bookmarks = [];
      let hasMoreData = true;
      
      // API å‡½æ•¸ - å¸¶é‡è©¦æ©Ÿåˆ¶
      async function fetchFromAPIWithRetry(page = 1, limit = 10) {
        const maxRetries = 15;
        
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
          try {
            const url = `https://dae-mobile-assignment.hkit.cc/api/yoga-poses/?page=${page}&limit=${limit}`;
            console.log(`API å˜—è©¦ ${attempt}/${maxRetries}:`, url);
            
            // æ›´æ–°è¼‰å…¥æ¶ˆæ¯
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) {
              loadingMessage.textContent = `è¼‰å…¥ç‘œä¼½å‹•ä½œä¸­... (å˜—è©¦ ${attempt}/${maxRetries})`;
            }
            
            const response = await fetch(url);
            
            if (!response.ok) {
              throw new Error(`HTTP éŒ¯èª¤: ${response.status}`);
            }
            
            const data = await response.json();
            console.log('API éŸ¿æ‡‰:', data);
            
            // æª¢æŸ¥æ˜¯å¦æ˜¯æ¸¬è©¦éŒ¯èª¤
            if (data.error) {
              console.log('æ”¶åˆ°æ¸¬è©¦éŒ¯èª¤ï¼Œé‡è©¦ä¸­...', data.error);
              if (attempt < maxRetries) {
                await new Promise(resolve => setTimeout(resolve, 500));
                continue;
              } else {
                throw new Error(`API æ¸¬è©¦éŒ¯èª¤: ${data.error}`);
              }
            }
            
            // æˆåŠŸç²å–æ•¸æ“š
            if (data.items && Array.isArray(data.items)) {
              const totalItems = data.pagination?.total || data.items.length;
              const currentTotal = (page - 1) * limit + data.items.length;
              const hasMoreItems = data.pagination ? (currentTotal < totalItems) : (data.items.length === limit);
              
              console.log('åˆ†é ä¿¡æ¯:', {
                page,
                limit,
                itemsInResponse: data.items.length,
                totalItems,
                currentTotal,
                hasMoreItems
              });
              
              return {
                items: data.items,
                total: totalItems,
                hasMore: hasMoreItems
              };
            } else {
              throw new Error('ç„¡æ•ˆçš„æ•¸æ“šæ ¼å¼');
            }
            
          } catch (error) {
            console.log(`å˜—è©¦ ${attempt} å¤±æ•—:`, error.message);
            
            if (attempt < maxRetries) {
              await new Promise(resolve => setTimeout(resolve, 1000));
            } else {
              throw error;
            }
          }
        }
      }
      
      // é¡¯ç¤ºæ•¸æ“š
      function displayItems(items) {
        console.log('é¡¯ç¤ºé …ç›®:', items.length);
        const list = document.getElementById('poses-list');
        const loading = document.getElementById('loading-container');
        const pagination = document.getElementById('pagination-container');
        
        if (!list) {
          console.error('æ‰¾ä¸åˆ° poses-list å…ƒç´ ');
          return;
        }
        
        // å¦‚æœæ˜¯ç¬¬ä¸€é ï¼Œæ¸…ç©ºåˆ—è¡¨
        if (currentPage === 1) {
          list.innerHTML = '<div class="poses-grid"></div>';
        }
        
        const grid = list.querySelector('.poses-grid');
        
        items.forEach(item => {
          const card = document.createElement('ion-card');
          card.className = 'pose-card';
          
          card.innerHTML = `
            <ion-card-header>
              <ion-card-title>${item.title || item.sanskrit_name || 'ç„¡æ¨™é¡Œ'}</ion-card-title>
              <ion-card-subtitle>
                ${item.category || 'æœªåˆ†é¡'} â€¢ ${item.difficulty || 'æœªè¨­å®š'} â€¢ ${item.duration_minutes ? item.duration_minutes + ' åˆ†é˜' : 'æœªè¨­å®šæ™‚é•·'}
              </ion-card-subtitle>
            </ion-card-header>
            
            <ion-card-content>
              ${item.image_url ? `
                <img class="item-image" src="${item.image_url}" alt="${item.title || item.sanskrit_name}" loading="lazy">
              ` : ''}
              
              <p><strong>æ¢µæ–‡å:</strong> ${item.sanskrit_name || 'ç„¡'}</p>
              <p><strong>æ•™ç·´:</strong> ${item.instructor || 'æœªè¨­å®š'}</p>
              <p><strong>èªªæ˜:</strong> ${item.description || 'ç„¡èªªæ˜'}</p>
              
              ${item.benefits && Array.isArray(item.benefits) ? `
                <p><strong>å¥½è™•:</strong></p>
                <ul>
                  ${item.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                </ul>
              ` : ''}
              
              ${item.video_url ? `
                <div style="margin-top: 10px;">
                  <ion-button href="${item.video_url}" target="_blank" fill="outline" size="small">
                    <ion-icon name="play-circle-outline" slot="start"></ion-icon>
                    è§€çœ‹è¦–é »
                  </ion-button>
                </div>
              ` : ''}
              
              <div style="margin-top: 10px;">
                <ion-button fill="clear" size="small" onclick="toggleBookmark(${item.id})">
                  <ion-icon name="${bookmarks.includes(item.id) ? 'bookmark' : 'bookmark-outline'}" slot="start"></ion-icon>
                  ${bookmarks.includes(item.id) ? 'å·²æ”¶è—' : 'æ”¶è—'}
                </ion-button>
              </div>
            </ion-card-content>
          `;
          
          grid.appendChild(card);
        });
        
        // æ›´æ–°é¡¯ç¤ºç‹€æ…‹
        loading.style.display = 'none';
        list.style.display = 'block';
        
        // æ›´æ–°åˆ†é ä¿¡æ¯
        updatePaginationInfo();
        pagination.style.display = 'block';
        
        console.log('æ•¸æ“šé¡¯ç¤ºå®Œæˆ');
      }
      
      // æ›´æ–°åˆ†é ä¿¡æ¯
      function updatePaginationInfo() {
        const info = document.getElementById('pagination-info');
        const loadMoreBtn = document.getElementById('load-more-btn');
        const noMoreData = document.getElementById('no-more-data');
        const pagination = document.getElementById('pagination-container');
        
        const totalDisplayed = allItems.length;
        const pageInfo = currentPage > 1 ? ` (ç¬¬ ${currentPage} é )` : '';
        
        info.innerHTML = `
          <strong>å·²é¡¯ç¤º ${totalDisplayed} é …ç‘œä¼½å‹•ä½œ</strong>${pageInfo}
          <br>
          <small style="color: #666;">æ¯é è¼‰å…¥ ${itemsPerPage} é …</small>
        `;
        
        console.log('æ›´æ–°åˆ†é ä¿¡æ¯:', {
          totalDisplayed,
          hasMoreData,
          currentPage,
          itemsPerPage,
          pageInfo
        });
        
        // ç¢ºä¿åˆ†é å®¹å™¨é¡¯ç¤º
        pagination.style.display = 'block';
        
        if (hasMoreData) {
          loadMoreBtn.style.display = 'block';
          loadMoreBtn.disabled = false;
          noMoreData.style.display = 'none';
          console.log('é¡¯ç¤ºè¼‰å…¥æ›´å¤šæŒ‰éˆ•');
        } else {
          loadMoreBtn.style.display = 'none';
          noMoreData.style.display = 'block';
          noMoreData.innerHTML = `
            <ion-icon name="checkmark-circle" style="color: #28a745; margin-right: 8px;"></ion-icon>
            å·²è¼‰å…¥æ‰€æœ‰ç‘œä¼½å‹•ä½œ (å…± ${totalDisplayed} é …)
          `;
          console.log('é¡¯ç¤ºæ²’æœ‰æ›´å¤šæ•¸æ“šæç¤º');
        }
      }
      
      // é¡¯ç¤ºéŒ¯èª¤
      function showError(message) {
        console.error('é¡¯ç¤ºéŒ¯èª¤:', message);
        const loading = document.getElementById('loading-container');
        const error = document.getElementById('error-container');
        const errorMsg = document.getElementById('error-message');
        
        loading.style.display = 'none';
        errorMsg.textContent = message;
        error.style.display = 'block';
      }
      
      // è¼‰å…¥æ•¸æ“š
      async function loadData() {
        console.log('ğŸš€ é–‹å§‹è¼‰å…¥ç‘œä¼½å‹•ä½œæ•¸æ“š...');
        const loading = document.getElementById('loading-container');
        const error = document.getElementById('error-container');
        const list = document.getElementById('poses-list');
        const pagination = document.getElementById('pagination-container');
        
        // é‡ç½®ç‹€æ…‹
        currentPage = 1;
        allItems = [];
        hasMoreData = true;
        loading.style.display = 'block';
        error.style.display = 'none';
        list.style.display = 'none';
        pagination.style.display = 'none';
        
        console.log(`è¼‰å…¥åƒæ•¸: page=${currentPage}, limit=${itemsPerPage}`);
        
        try {
          const result = await fetchFromAPIWithRetry(currentPage, itemsPerPage);
          
          if (!result.items || result.items.length === 0) {
            showError('æ²’æœ‰æ‰¾åˆ°ç‘œä¼½å‹•ä½œæ•¸æ“š');
            return;
          }
          
          // è¨­ç½®åˆå§‹æ•¸æ“š
          allItems = result.items;
          hasMoreData = result.hasMore;
          filteredItems = [...allItems];
          
          console.log(`âœ… é¦–æ¬¡è¼‰å…¥æˆåŠŸ: ${result.items.length} é …, hasMore: ${result.hasMore}`);
          
          displayItems(allItems);
          
        } catch (error) {
          console.error('âŒ è¼‰å…¥æ•¸æ“šå¤±æ•—:', error);
          showError(`è¼‰å…¥å¤±æ•—: ${error.message}`);
        }
      }
      
      // è¼‰å…¥æ›´å¤šæ•¸æ“š
      async function loadMoreData() {
        if (!hasMoreData) {
          console.log('æ²’æœ‰æ›´å¤šæ•¸æ“šå¯è¼‰å…¥');
          return;
        }
        
        const loadMoreBtn = document.getElementById('load-more-btn');
        const loadMoreError = document.getElementById('load-more-error');
        
        try {
          // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
          loadMoreBtn.disabled = true;
          loadMoreBtn.innerHTML = `
            <ion-spinner name="crescent" style="width: 16px; height: 16px; margin-right: 8px;"></ion-spinner>
            è¼‰å…¥ä¸­...
          `;
          loadMoreError.style.display = 'none';
          
          console.log(`è¼‰å…¥ç¬¬ ${currentPage + 1} é æ•¸æ“š...`);
          currentPage++;
          
          const result = await fetchFromAPIWithRetry(currentPage, itemsPerPage);
          
          if (result.items.length === 0) {
            // æ²’æœ‰æ›´å¤šæ•¸æ“š
            hasMoreData = false;
            updatePaginationInfo();
            return;
          }
          
          // åˆä½µæ–°æ•¸æ“š
          allItems = [...allItems, ...result.items];
          hasMoreData = result.hasMore;
          filteredItems = [...allItems];
          
          console.log(`æˆåŠŸè¼‰å…¥ ${result.items.length} é …æ–°æ•¸æ“šï¼Œç¸½è¨ˆ ${allItems.length} é …`);
          
          // é¡¯ç¤ºæ–°æ•¸æ“šï¼ˆè¿½åŠ åˆ°ç¾æœ‰åˆ—è¡¨ï¼‰
          displayItems(result.items);
          
        } catch (error) {
          console.error('è¼‰å…¥æ›´å¤šå¤±æ•—:', error);
          
          // å›é€€é ç¢¼ï¼ˆå› ç‚ºè«‹æ±‚å¤±æ•—ï¼‰
          currentPage--;
          
          // é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
          loadMoreError.style.display = 'block';
          loadMoreError.textContent = `è¼‰å…¥å¤±æ•—: ${error.message}`;
          
          // 3ç§’å¾Œéš±è—éŒ¯èª¤ä¿¡æ¯
          setTimeout(() => {
            loadMoreError.style.display = 'none';
          }, 3000);
          
        } finally {
          // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
          loadMoreBtn.disabled = false;
          loadMoreBtn.innerHTML = 'è¼‰å…¥æ›´å¤š';
        }
      }
      
      // æ”¶è—åŠŸèƒ½
      function toggleBookmark(itemId) {
        const index = bookmarks.indexOf(itemId);
        if (index > -1) {
          bookmarks.splice(index, 1);
        } else {
          bookmarks.push(itemId);
        }
        
        // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æ”¶è—ç‹€æ…‹
        const list = document.getElementById('poses-list');
        list.innerHTML = '<div class="poses-grid"></div>';
        displayItems(allItems);
      }
      
      // æœç´¢å’Œç¯©é¸åŠŸèƒ½
      function filterItems() {
        const searchTerm = document.getElementById('search-bar').value.toLowerCase();
        const selectedCategory = document.getElementById('category-select').value;
        
        console.log('ç¯©é¸æ¢ä»¶:', { searchTerm, selectedCategory });
        
        filteredItems = allItems.filter(item => {
          const matchesSearch = !searchTerm || 
            (item.title && item.title.toLowerCase().includes(searchTerm)) ||
            (item.sanskrit_name && item.sanskrit_name.toLowerCase().includes(searchTerm)) ||
            (item.description && item.description.toLowerCase().includes(searchTerm)) ||
            (item.benefits && Array.isArray(item.benefits) && item.benefits.some(b => b.toLowerCase().includes(searchTerm)));
          
          const matchesCategory = !selectedCategory || item.category === selectedCategory;
          
          return matchesSearch && matchesCategory;
        });
        
        console.log(`ç¯©é¸çµæœ: ${filteredItems.length}/${allItems.length} é …`);
        
        // é‡æ–°é¡¯ç¤ºç¯©é¸å¾Œçš„æ•¸æ“š
        const list = document.getElementById('poses-list');
        list.innerHTML = '<div class="poses-grid"></div>';
        displayItems(filteredItems);
        
        // æ›´æ–°åˆ†é ä¿¡æ¯ï¼ˆç¯©é¸æ™‚éš±è—è¼‰å…¥æ›´å¤šæŒ‰éˆ•ï¼‰
        const pagination = document.getElementById('pagination-container');
        const loadMoreBtn = document.getElementById('load-more-btn');
        const noMoreData = document.getElementById('no-more-data');
        const info = document.getElementById('pagination-info');
        
        if (searchTerm || selectedCategory) {
          // æœ‰ç¯©é¸æ¢ä»¶æ™‚ï¼Œéš±è—è¼‰å…¥æ›´å¤šåŠŸèƒ½
          loadMoreBtn.style.display = 'none';
          noMoreData.style.display = 'none';
          info.innerHTML = `
            <strong>ç¯©é¸çµæœ: ${filteredItems.length} é …</strong>
            <br>
            <small style="color: #666;">æ¸…é™¤ç¯©é¸æ¢ä»¶å¯è¼‰å…¥æ›´å¤šæ•¸æ“š</small>
          `;
        } else {
          // æ²’æœ‰ç¯©é¸æ¢ä»¶æ™‚ï¼Œæ¢å¾©åˆ†é åŠŸèƒ½
          updatePaginationInfo();
        }
      }
      
      // èªè­‰ç›¸é—œåŠŸèƒ½ï¼ˆç°¡åŒ–ç‰ˆï¼‰
      function openAuthModal() {
        document.getElementById('auth-modal').present();
      }
      
      function closeAuthModal() {
        document.getElementById('auth-modal').dismiss();
      }
      
      function closeLogoutModal() {
        document.getElementById('logout-confirm-modal').dismiss();
      }
      
      function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        const title = document.getElementById('auth-title');
        const submitBtn = document.getElementById('auth-submit-btn');
        const toggleBtn = document.getElementById('auth-toggle-btn');
        const confirmPasswordItem = document.getElementById('confirm-password-item');
        
        if (isLoginMode) {
          title.textContent = 'ç™»å…¥';
          submitBtn.textContent = 'ç™»å…¥';
          toggleBtn.textContent = 'é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿè¨»å†Š';
          confirmPasswordItem.style.display = 'none';
        } else {
          title.textContent = 'è¨»å†Š';
          submitBtn.textContent = 'è¨»å†Š';
          toggleBtn.textContent = 'å·²æœ‰å¸³è™Ÿï¼Ÿç™»å…¥';
          confirmPasswordItem.style.display = 'block';
        }
      }
      
      function handleAuth() {
        // ç°¡åŒ–çš„èªè­‰è™•ç†
        const email = document.getElementById('email-input').value;
        if (email) {
          currentUser = { email };
          document.getElementById('auth-btn').textContent = 'ç™»å‡º';
          closeAuthModal();
        }
      }
      
      function confirmLogout() {
        currentUser = null;
        document.getElementById('auth-btn').textContent = 'ç™»å…¥';
        closeLogoutModal();
      }
      
      // åˆå§‹åŒ–æ‡‰ç”¨
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM å·²åŠ è¼‰ï¼Œé–‹å§‹åˆå§‹åŒ–...');
        
        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        document.getElementById('search-bar').addEventListener('ionInput', filterItems);
        document.getElementById('category-select').addEventListener('ionChange', filterItems);
        document.getElementById('limit-select').addEventListener('ionChange', (e) => {
          itemsPerPage = parseInt(e.detail.value);
          loadData(); // é‡æ–°è¼‰å…¥æ•¸æ“š
        });
        
        document.getElementById('auth-btn').addEventListener('click', () => {
          if (currentUser) {
            document.getElementById('logout-confirm-modal').present();
          } else {
            openAuthModal();
          }
        });
        
        // é–‹å§‹è¼‰å…¥æ•¸æ“š
        loadData();
      });
    </script>
  </body>
</html>